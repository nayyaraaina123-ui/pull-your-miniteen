<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tarik Tambang Matematika</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    font-family:'Press Start 2P', cursive;
    color:white;
    overflow:hidden;
    image-rendering:pixelated;
}

/* BACKGROUND */

#bgVideo{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    object-fit:cover;
    z-index:-2;
    transition:0.5s ease;
}

#bgImage{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background-size:cover;
    background-position:center;
    z-index:-3;
    opacity:0;
    transition:0.5s ease;
}

/* SCREEN */

.screen{
    display:none;
    text-align:center;
    padding:20px;
}

.active{ display:block; }

/* TEXT */

h1,h2,p,span{
    text-shadow:3px 3px 0 #000,-2px -2px 0 #000,2px -2px 0 #000,-2px 2px 0 #000;
}

/* BUTTON */

button{
    padding:15px 35px;
    font-family:'Press Start 2P', cursive;
    font-size:14px;
    background:#ff3cac;
    color:white;
    border:4px solid #000;
    cursor:pointer;
    box-shadow:6px 6px 0 #000;
}

button:active{
    box-shadow:2px 2px 0 #000;
    transform:translate(4px,4px);
}

/* START */

#startScreen{
    position:relative;
    height:100vh;
}

#startScreen button{
    position:absolute;
    left:50%;
    top:75%;
    transform:translate(-50%, -50%);
}

/* SLIDER */

.slider{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:30px;
    margin-top:40px;
}

.character-display img{
    width:200px;
    height:200px;
    object-fit:contain;
}

/* COUNTDOWN */

#countdownOverlay{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.85);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:2000;
}

#countdownText{
    font-size:120px;
    animation:pop 0.8s ease;
    text-shadow:6px 6px 0 #000;
}

@keyframes pop{
    0%{ transform:scale(0.3); opacity:0; }
    50%{ transform:scale(1.2); opacity:1; }
    100%{ transform:scale(1); }
}

/* GAME */

.status{
    display:flex;
    justify-content:space-around;
    margin-top:20px;
    font-size:16px;
}

.icon{
    font-size:32px;
    margin-right:8px;
}

.arena{
    position:relative;
    margin-top:60px;
}

.player-character{
    position:absolute;
    width:250px;
    height:250px;
    object-fit:contain;
    bottom:-60px;
    transition:0.3s ease;
    z-index:10;
}

#enemyChar{
    left:-5%;
    transform:scaleX(-1);
}

#userChar{
    right:-5%;
}

/* ROPE */

.rope-container{
    width:90%;
    height:30px;
    background:#444;
    margin:120px auto 30px auto;
    border:4px solid black;
    position:relative;
    z-index:1;
}

.rope{
    width:100%;
    height:100%;
    background:repeating-linear-gradient(
        90deg,#8B4513 0px,#8B4513 10px,#A0522D 10px,#A0522D 20px
    );
}

.marker{
    width:30px;
    height:30px;
    background:red;
    border:3px solid black;
    position:absolute;
    top:-5px;
    left:50%;
    transform:translateX(-50%);
    transition:left 0.3s ease;
}

/* ANIMATION TARIK SEKALI */

@keyframes pullLeft {
    0%{ transform:translateX(0) scaleX(-1); }
    50%{ transform:translateX(-20px) scaleX(-1); }
    100%{ transform:translateX(0) scaleX(-1); }
}

@keyframes pullRight {
    0%{ transform:translateX(0); }
    50%{ transform:translateX(20px); }
    100%{ transform:translateX(0); }
}

.pull-left-once{
    animation:pullLeft 0.4s ease;
}

.pull-right-once{
    animation:pullRight 0.4s ease;
}

/* POPUP */

.popup{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.8);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:999;
}

.popup-box{
    background:#111;
    padding:40px;
    border:6px solid white;
    box-shadow:10px 10px 0 black;
    text-align:center;
}
</style>
</head>

<body>

<video autoplay muted loop playsinline id="bgVideo">
    <source src="background.mp4" type="video/mp4">
</video>

<div id="bgImage"></div>

<div id="startScreen" class="screen active">
    <button onclick="goToCharacter()">Mulai</button>
</div>

<div id="characterScreen" class="screen">
    <h2>Pilih Karakter</h2>

    <div class="slider">
        <button onclick="prevCharacter()">‚óÄ</button>
        <div class="character-display">
            <img id="characterImage" src="karakter1.png">
            <p id="characterName">Karakter 1</p>
        </div>
        <button onclick="nextCharacter()">‚ñ∂</button>
    </div>

    <br>
    <button onclick="selectCharacter()">Pilih</button>
    <br><br>
    <button onclick="startGame()">Mulai Game</button>
</div>

<div id="gameScreen" class="screen">

<div id="countdownOverlay">
    <div id="countdownText">3</div>
</div>

<div class="status">
    <div><span class="icon">‚ù§Ô∏è</span><span id="life1">3</span></div>
    <div><span class="icon">‚è≥</span><span id="timer">10</span></div>
</div>

<div class="arena">
    <img id="enemyChar" class="player-character" src="enemy.png">
    <img id="userChar" class="player-character" src="">

    <div class="rope-container">
        <div class="rope"></div>
        <div class="marker" id="marker"></div>
    </div>
</div>

<h2 id="question"></h2>
<input type="number" id="answerInput">
<br><br>
<button onclick="submitAnswer()">Jawab</button>

</div>

<div id="gamePopup" class="popup">
    <div class="popup-box">
        <h2 id="popupText"></h2>
        <button onclick="restartGame()">Main Lagi</button>
    </div>
</div>

<audio id="winSound" src="win.mp3"></audio>
<audio id="loseSound" src="lose.mp3"></audio>

<script>

let characterIndex = 0;
let selectedChar = null;

let characters = [
    {name:"Choitcherry", img:"karakter1.png"},
    {name:"Jjongtoram", img:"karakter2.png"},
    {name:"Shuasumi", img:"karakter3.png"},
    {name:"O.C.L", img:"karakter4.png"},
    {name:"Tamtam", img:"karakter5.png"},
    {name:"Foxdungee", img:"karakter6.png"},
    {name:"Ppyopuli", img:"karakter7.png"},
    {name:"THEpalee", img:"karakter8.png"},
    {name:"Kimja", img:"karakter9.png"},
    {name:"Doa", img:"karakter10.png"},
    {name:"Bboogyuli", img:"karakter11.png"},
    {name:"Nonver", img:"karakter12.png"},
    {name:"Chandalee", img:"karakter13.png"}
];

let position = 50;
let correctAnswer = 0;
let timeLeft = 10;
let timerInterval;
let enemyInterval;
let life1 = 3;

function showImageBackground(imageFile){
    document.getElementById("bgVideo").style.opacity="0";
    let bg=document.getElementById("bgImage");
    bg.style.backgroundImage=`url('${imageFile}')`;
    bg.style.opacity="1";
}

function goToCharacter(){
    document.getElementById("startScreen").classList.remove("active");
    document.getElementById("characterScreen").classList.add("active");
    showImageBackground("background1.jpg");
    updateCharacter();
}

function updateCharacter(){
    document.getElementById("characterImage").src=characters[characterIndex].img;
    document.getElementById("characterName").innerText=characters[characterIndex].name;
}

function nextCharacter(){
    characterIndex=(characterIndex+1)%characters.length;
    updateCharacter();
}

function prevCharacter(){
    characterIndex=(characterIndex-1+characters.length)%characters.length;
    updateCharacter();
}

function selectCharacter(){
    selectedChar=characters[characterIndex];
}

function startGame(){
    if(!selectedChar) return alert("Pilih karakter dulu!");

    document.getElementById("characterScreen").classList.remove("active");
    document.getElementById("gameScreen").classList.add("active");

    showImageBackground("background2.jpg");

    document.getElementById("userChar").src=selectedChar.img;

    position=50;
    life1=3;
    document.getElementById("life1").innerText=life1;
    updateMarker();

    startCountdown(); // ‚¨Ö mulai hitungan mundur dulu
}

function startCountdown(){
    let overlay=document.getElementById("countdownOverlay");
    let text=document.getElementById("countdownText");

    let count=3;
    overlay.style.display="flex";
    text.innerText=count;

    let countdownInterval=setInterval(()=>{
        count--;

        if(count>0){
            text.style.animation="none";
            void text.offsetWidth; 
            text.style.animation="pop 0.8s ease";
            text.innerText=count;
        }else if(count===0){
            text.innerText="GO!";
            text.style.animation="none";
            void text.offsetWidth;
            text.style.animation="pop 0.8s ease";
        }else{
            clearInterval(countdownInterval);
            overlay.style.display="none";

            // Game benar-benar mulai di sini
            generateQuestion();
            startTimer();
            startEnemyAI();
        }
    },1000);
}

function generateQuestion(){
    let n1=Math.floor(Math.random()*10)+1;
    let n2=Math.floor(Math.random()*10)+1;
    correctAnswer=n1+n2;
    document.getElementById("question").innerText=`${n1} + ${n2} = ?`;
}

function startTimer(){
    timeLeft=10;
    document.getElementById("timer").innerText=timeLeft;

    timerInterval=setInterval(()=>{
        timeLeft--;
        document.getElementById("timer").innerText=timeLeft;
        if(timeLeft<=0){ clearInterval(timerInterval); loseTurn(); }
    },1000);
}

function startEnemyAI(){
    enemyInterval=setInterval(()=>{
        position-=1;
        updateMarker();
        if(position<=10) gameOver(false);
    },1200);
}

function updateMarker(){
    position=Math.max(10,Math.min(90,position));
    document.getElementById("marker").style.left=position+"%";
}

function animateUserPull(){
    let user=document.getElementById("userChar");
    user.classList.add("pull-right-once");
    setTimeout(()=>{ user.classList.remove("pull-right-once"); },400);
}

function animateEnemyPull(){
    let enemy=document.getElementById("enemyChar");
    enemy.classList.add("pull-left-once");
    setTimeout(()=>{ enemy.classList.remove("pull-left-once"); },400);
}

function submitAnswer(){
    clearInterval(timerInterval);
    let ans=parseInt(document.getElementById("answerInput").value);

    if(ans===correctAnswer){
        position+=6;
        animateUserPull();
    }else{
        position-=5;
        life1--;
        document.getElementById("life1").innerText=life1;
        animateEnemyPull();
    }

    updateMarker();

    if(position>=90) return gameOver(true);
    if(position<=10||life1<=0) return gameOver(false);

    document.getElementById("answerInput").value="";
    generateQuestion();
    startTimer();
}

function loseTurn(){
    life1--;
    document.getElementById("life1").innerText=life1;
    position-=5;
    animateEnemyPull();
    updateMarker();
    if(position<=10||life1<=0) return gameOver(false);
    generateQuestion();
    startTimer();
}

function gameOver(win){
    clearInterval(timerInterval);
    clearInterval(enemyInterval);

    let popup=document.getElementById("gamePopup");
    let text=document.getElementById("popupText");

    popup.style.display="flex";

    if(win){
        text.innerText="KAMU MENANG! üî•";
        document.getElementById("winSound").play();
    }else{
        text.innerText="KAMU KALAH! üò≠";
        document.getElementById("loseSound").play();
    }
}

function restartGame(){
    location.reload();
}

</script>

</body>

</html>
